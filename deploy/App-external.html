<!DOCTYPE html>
<html>
<head>
    <title>FeatureDependencyList</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("FeatureDependencyList",{extend:"Rally.app.App",componentCls:"app",myModels:["PortfolioItem/Feature"],myGrid:void 0,launch:function(){var e=this;console.log("Create new TreeStore"),Ext.create("Rally.data.wsapi.TreeStoreBuilder").build({models:e.myModels,fetch:["Predecessors","FormattedID","Name","Successors","Project","State","Release"],enableHierarchy:!1,scope:e,listeners:{scope:e,load:function(t){var o=t.getRootNode().childNodes;console.log("store:event - load");var s=e._getAllDecessors(o);Deft.Promise.all(s).then({scope:e,success:function(){console.log("_getAllDecessors done"),e.myGrid?(console.log("grid already created, me.myGrid = ",e.myGrid),e.myGrid.getGridOrBoard().getView().refresh()):e._onStoreBuilt(t)}})}}}).then({success:e._loadStore,scope:e})},_loadStore:function(e){console.log("calling store.load()"),e.load()},_getAllDecessors:function(e){console.log("_getAllDecessors()");var t=[];return _.each(e,function(e){e.predecessorStore=e.getCollection("Predecessors"),e.successorStore=e.getCollection("Successors"),e.predecessorStore.initialCount>0&&t.push(e.predecessorStore.load({fetch:["FormattedID","Name","Project","State","Release"]})),e.successorStore.initialCount>0&&t.push(e.successorStore.load({fetch:["FormattedID","Name","Project","State","Release"]}))}),t},_onStoreBuilt:function(e){var t=this,o=t.getContext();console.log("_onStoreBuilt: function (store) =  ",e),t.myGrid=t.add({xtype:"rallygridboard",modelNames:t.myModels,toggleState:"grid",stateful:!1,context:o,plugins:[{ptype:"rallygridboardinlinefiltercontrol",inlineFilterButtonConfig:{modelNames:t.myModels,stateful:!0,stateId:o.getScopedStateId("ReleaseDependeciesList-Filter"),inlineFilterPanelConfig:{collapsed:!0,quickFilterPanelConfig:{defaultFields:["Release"]}}}}],gridConfig:{store:e,columnCfgs:[{text:"ID",dataIndex:"FormattedID",width:50},{text:"Name",dataIndex:"Name",flex:1},{text:"Release",dataIndex:"Release"},{text:"State",dataIndex:"State"},{align:"left",text:"Successors",dataIndex:"Successors",width:300,renderer:function(e,o,s){console.log("successors:renders");var r=s.successorStore.getRecords();return t._renderSuccessor(r)}}]},height:t.getHeight()})},_renderSuccessor:function(e){var t="";return _.each(e,function(e){t+=Rally.nav.DetailLink.getLink({record:e,text:e.get("FormattedID"),showTooltip:!0}),t+=" - "+e.get("Name"),e.get("Release")?t+=" ("+e.get("Release").Name+")":t+=" (Not planned)",t+="<br>"}),t}});

            Rally.launchApp('FeatureDependencyList', {
                name:"FeatureDependencyList",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
